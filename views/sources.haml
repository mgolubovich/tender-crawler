- @title = 'Sources list'
%h1 Sources list
.container-fluid
  .col-lg-4.pull-right
    %form{:action => "/sources", :method => "get"}
      .input-group
        %input.form-control{:name => "search", :type => "text", :placeholder => "Search", :value => params[:search]}
        %span.input-group-btn
          %button.btn.btn-primary Искать
.container-fluid
  %table.table.table-condensed.table-bordered
    %thead
      %a.btn.btn-info.pull-right{href: "/sources/new", style: "margin-bottom: 10px;"}
        %b +
        Add new source
      %tr
        %td
        %td Name
        %td Tenders count
        %td Construction
        %td Cartridge count
        / %td Update frequency
        %td.text-center Control
        %td Activity?
    %tbody
      - @sources.each do |source|
        %tr{:class => source.is_active ? "success" : "default" }
          %td= @source_counter += 1
          - if source.url.empty?
            %td= source.name
          - else
            %td
              %a{ href: "#{source.url}", target: "_blank" }
                %b= source.name
          %td
            %a{ href: "/tenders?source_id=#{source.id}"}= source.tenders_count
          %td= source.construction_tenders_count
          %td
            %a{ href: "/cartridges?source_id=#{source.id}", title: "Active: #{source.cartridges.active.count}"}= source.cartridges.count
          / %td= source.tenders_update_frequency.strftime("%d %B %Y (%R)") if source.tenders_update_frequency
          %td.text-center
            %a.btn.btn-info.btn-xs{ href: "/sources/edit/#{source.id}"}
              %span.glyphicon.glyphicon-edit
              Edit
            %a.btn.btn-danger.btn-xs{ href: "/sources/destroy/#{source.id}", onclick: "return ORLY();"}
              %span.glyphicon.glyphicon-remove
              Delete
          %td= source.is_active ? "Yes" : "No"
  = will_paginate @sources, renderer: BootstrapPagination::Sinatra
